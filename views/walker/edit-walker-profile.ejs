<link rel="stylesheet" href="/walker-profile.css" />

<form
  action="/walker/update-walker-profile"
  method="POST"
  enctype="multipart/form-data"
  id="update-walker-profile"
>
  <div class="profile-container">
    <div class="profile-card">
      <!-- Walker Profile Image -->
      <img
        id="userImage"
        src="/get-user-photo"
        alt="User Image"
        class="walker-image"
      />

      <!-- Upload Photo Button -->
      <div class="mt-4">
        <input
          type="file"
          name="userPhoto"
          id="fileInput"
          style="display: none"
          accept="image/*"
        />
        <button
          type="button"
          class="button-design-2"
          onclick="document.getElementById('fileInput').click()"
        >
          Upload Photo
        </button>
        <span id="fileName" style="color: #686868">No file chosen</span>
      </div>

      <hr class="mt-4 mb-4" />

      <!-- Contact Walker Section with various social media links -->
      <div class="contact-walker">
        <h3 class="mb-3">Social Media Link</h3>

        <div class="social-icons-2 mt-3">
          <!-- WhatsApp -->
          <div class="row align-items-center">
            <div class="col-auto">
              <img src="/assets/whatsapp.png" alt="WhatsApp" />
            </div>
            <div class="col">
              <input
                type="text"
                name="whatsapp-link"
                id="whatsapp-link"
                class="form-control"
                placeholder="WhatsApp Link"
              />
            </div>
          </div>

          <!-- Facebook -->
          <div class="row align-items-center">
            <div class="col-auto">
              <img src="/assets/facebook.png" alt="Facebook" />
            </div>
            <div class="col">
              <input
                type="text"
                name="facebook-link"
                id="facebook-link"
                class="form-control"
                placeholder="Facebook Link"
              />
            </div>
          </div>

          <!-- Instagram -->
          <div class="row align-items-center">
            <div class="col-auto">
              <img src="/assets/instagram.png" alt="Instagram" />
            </div>
            <div class="col">
              <input
                type="text"
                name="instagram-link"
                id="instagram-link"
                class="form-control"
                placeholder="Instagram Link"
              />
            </div>
          </div>

          <!-- LinkedIn -->
          <div class="row align-items-center">
            <div class="col-auto">
              <img src="/assets/linkedin.png" alt="LinkedIn" />
            </div>
            <div class="col">
              <input
                type="text"
                name="linkedin-link"
                id="linkedin-link"
                class="form-control"
                placeholder="LinkedIn Link"
              />
            </div>
          </div>

          <!-- SnapChat -->
          <div class="row align-items-center">
            <div class="col-auto">
              <img src="/assets/snapchat.png" alt="SnapChat" />
            </div>
            <div class="col">
              <input
                type="text"
                name="snapchat-link"
                id="snapchat-link"
                class="form-control"
                placeholder="SnapChat Link"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Details Section -->
    <div class="profile-details">
      <h3>Edit Profile</h3>
      <!-- First row: Username and Email -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="username" class="form-label"><b>Username</b></label>
          <input
            type="text"
            class="form-control"
            id="username"
            name="username"
            value="<%= user.username %>"
            autocomplete="off"
          />
          <div class="error-container">
            <i
              id="username-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="username-error" class="text-danger"></div>
          </div>
        </div>
        <div class="col-md-6">
          <label for="email" class="form-label"><b>Email</b></label>
          <input
            type="text"
            class="form-control"
            id="email"
            name="email"
            value="<%= user.email %>"
            autocomplete="off"
          />
          <div class="error-container">
            <i
              id="email-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="email-error" class="text-danger"></div>
          </div>
        </div>
      </div>

      <!-- Second row: Quotes and Location -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="walker_quote" class="form-label"><b>Quote</b></label>
          <input
            type="text"
            class="form-control"
            id="walker_quote"
            name="walker_quote"
            value="<%= walkerData.walker_quote %>"
            autocomplete="off"
          />
          <div class="error-container">
            <i
              id="quote-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="quote-error" class="text-danger"></div>
          </div>
        </div>
        <div class="col-md-6">
          <label for="walker_location" class="form-label"
            ><b>Location</b></label
          >
          <input
            type="text"
            class="form-control"
            id="walker_location"
            name="walker_location"
            value="<%= walkerData.walker_location %>"
            autocomplete="off"
          />
          <div class="error-container">
            <i
              id="location-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="location-error" class="text-danger"></div>
          </div>
        </div>
      </div>

      <!-- Third row: Base Price and Contact -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="base_price" class="form-label"><b>Base Price</b></label>
          <input
            type="text"
            class="form-control"
            id="base_price"
            name="base_price"
            value="<%= walkerData.base_price %>"
            autocomplete="off"
          />
          <div class="error-container">
            <i
              id="price-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="price-error" class="text-danger"></div>
          </div>
        </div>
        <div class="col-md-6">
          <label for="walker_contact" class="form-label"><b>Contact</b></label>
          <input
            type="text"
            class="form-control"
            id="walker_contact"
            name="walker_contact"
            value="<%= walkerData.walker_contact %>"
            autocomplete="off"
          />
          <div class="error-container">
            <i
              id="contact-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="contact-error" class="text-danger"></div>
          </div>
        </div>
      </div>

      <!-- Fourth row: Bio -->
      <div class="row mb-3">
        <div class="col-md-12">
          <label for="walker_bio" class="form-label"><b>Bio</b></label>
          <textarea
            class="form-control"
            id="walker_bio"
            name="walker_bio"
            autocomplete="off"
            rows="6"
          >
<%= walkerData.walker_bio %></textarea
          >
          <div class="error-container">
            <i
              id="bio-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="bio-error" class="text-danger"></div>
          </div>
        </div>
      </div>

      <!-- Fifth row: Skills -->
      <div class="row mb-3">
        <div class="col-md-12">
          <label for="walker_skills" class="form-label"><b>Skills</b></label>
          <textarea
            class="form-control"
            id="walker_skills"
            name="walker_skills"
            autocomplete="off"
            rows="4"
          >
<%= walkerData.walker_skills %></textarea
          >
          <div class="error-container">
            <i
              id="skills-error-icon"
              class="bi bi-exclamation-triangle-fill error-icon"
              style="display: none"
            ></i>
            <div id="skills-error" class="text-danger"></div>
          </div>
        </div>

        <!-- Cancel and Update Buttons -->
        <div class="mt-3">
          <div class="col-12">
            <button
              type="reset"
              class="button-design-3 cancel"
              onclick="handleCancelClick()"
            >
              Cancel
            </button>
            <button type="submit" class="button-design-3 update">
              Edit & Update
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<script>
  function handleCancelClick() {
    // Reset the form fields
    document.querySelector("form").reset();

    // Navigate back to the previous page
    window.history.back();
  }

  // Display the selected file name
  document
    .getElementById("fileInput")
    .addEventListener("change", function (event) {
      const file = event.target.files[0];
      const fileNameSpan = document.getElementById("fileName");
      const userImage = document.getElementById("userImage");

      if (file) {
        // Update the file name text
        fileNameSpan.textContent = file.name;

        // Create a FileReader to read the file
        const reader = new FileReader();

        // Once the file is read, update the image src
        reader.onload = function (e) {
          userImage.src = e.target.result;
        };

        // Read the image file as a data URL
        reader.readAsDataURL(file);
      } else {
        fileNameSpan.textContent = "No file chosen";
      }
    });

  document
    .getElementById("update-walker-profile")
    .addEventListener("submit", function (event) {
      let valid = true;

      // Clear previous errors
      document.getElementById("username-error").textContent = "";
      document.getElementById("email-error").textContent = "";
      document.getElementById("quote-error").textContent = "";
      document.getElementById("location-error").textContent = "";
      document.getElementById("price-error").textContent = "";
      document.getElementById("contact-error").textContent = "";
      document.getElementById("bio-error").textContent = "";
      document.getElementById("skills-error").textContent = "";

      // Hide error icons
      document.getElementById("username-error-icon").style.display = "none";
      document.getElementById("email-error-icon").style.display = "none";
      document.getElementById("quote-error-icon").style.display = "none";
      document.getElementById("location-error-icon").style.display = "none";
      document.getElementById("price-error-icon").style.display = "none";
      document.getElementById("contact-error-icon").style.display = "none";
      document.getElementById("bio-error-icon").style.display = "none";
      document.getElementById("skills-error-icon").style.display = "none";

      // Validate Username
      const username = document.getElementById("username").value;
      if (username.length < 5) {
        document.getElementById("username-error").textContent =
          "Username must be at least 5 characters!";
        document.getElementById("username-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Email
      const email = document.getElementById("email").value;
      if (!email.includes("@") || !email.includes(".")) {
        document.getElementById("email-error").textContent =
          "Invalid email format!";
        document.getElementById("email-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Quote
      const quote = document.getElementById("walker_quote").value;
      if (quote.length < 5) {
        document.getElementById("quote-error").textContent =
          "Quote must be at least 5 characters!";
        document.getElementById("quote-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Location
      const location = document.getElementById("walker_location").value;
      if (location.length < 6) {
        document.getElementById("location-error").textContent =
          "Location must be at least 6 characters!";
        document.getElementById("location-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Price
      const price = document.getElementById("base_price").value.trim();
      const pricePattern = /^\d+$/; // Only digits allowed
      if (!pricePattern.test(price)) {
        document.getElementById("price-error").textContent =
          "Price must be a positive integer without decimal points.";
        document.getElementById("price-error-icon").style.display = "inline";
        valid = false;
      } else if (parseInt(price, 10) <= 0) {
        document.getElementById("price-error").textContent =
          "Price must be a positive number.";
        document.getElementById("price-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Contact Number
      const contactNumber = document
        .getElementById("walker_contact")
        .value.trim();
      const contactPattern = /^\d{8}$/; // Exactly 8 digits
      if (!contactPattern.test(contactNumber)) {
        document.getElementById("contact-error").textContent =
          "Contact number must be exactly 8 digits.";
        document.getElementById("contact-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Bio
      const bio = document.getElementById("walker_bio").value;
      if (bio.length < 10) {
        document.getElementById("bio-error").textContent =
          "Bio must be at least 10 characters!";
        document.getElementById("bio-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Skills
      const skills = document.getElementById("walker_skills").value;
      if (skills.length < 8) {
        document.getElementById("skills-error").textContent =
          "Skills must be at least 8 characters!";
        document.getElementById("skills-error-icon").style.display = "inline";
        valid = false;
      }

      if (!valid) {
        event.preventDefault();
      }
    });
</script>
