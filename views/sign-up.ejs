<link rel="stylesheet" href="/registration.css" />

<% if (message) { %>
<p class="message"><b><%= message %></b></p>
<% } %>

<!-- Container for the signup form with margin and alignment classes -->
<div class="box-design-1 mt-4 mb-4 justify-content-center align-items-center">
  <div class="form-container">
    <!-- Title for the signup form -->
    <h1 class="title-with-line">Sign Up</h1>

    <!-- Link to the sign-in page for users who already have an account -->
    <p>Already have an account? <a href="/sign-in">Sign In</a></p>

    <!-- Signup form with POST method -->
    <form id="signup-form" action="/sign-up" method="POST">
      <!-- Username input field -->
      <div class="mb-3">
        <label for="username" class="form-label"><b>Username</b></label>
        <input
          type="text"
          class="form-control"
          id="username"
          name="username"
          placeholder="Enter your username"
          required
          autocomplete="off"
          autofocus
        />

        <!-- Container for displaying username validation errors -->
        <div class="error-container">
          <i
            id="username-error-icon"
            class="bi bi-exclamation-triangle-fill error-icon"
            style="display: none"
          ></i>
          <div id="username-error" class="text-danger"></div>
        </div>
      </div>

      <!-- Email input field -->
      <div class="mb-3">
        <label for="email-signup" class="form-label"><b>Email</b></label>
        <input
          type="email"
          class="form-control"
          id="email-signup"
          name="email"
          placeholder="Enter your email"
          required
          autocomplete="off"
        />

        <!-- Container for displaying email validation errors -->
        <div class="error-container">
          <i
            id="email-error-icon"
            class="bi bi-exclamation-triangle-fill error-icon"
            style="display: none"
          ></i>
          <div id="email-error" class="text-danger"></div>
        </div>
      </div>

      <!-- Password input field -->
      <div class="mb-3">
        <label for="password-signup" class="form-label"><b>Password</b></label>
        <div class="input-group">
          <input
            type="password"
            class="form-control"
            id="password-signup"
            name="password"
            placeholder="Enter your password"
            required
            autocomplete="off"
          />
          <!-- Icon to toggle password visibility -->
          <span class="input-group-text" id="toggle-password-signup">
            <i class="bi bi-eye" id="toggle-password-signup-icon"></i>
          </span>
        </div>

        <!-- Container for displaying password validation errors -->
        <div class="error-container">
          <i
            id="password-error-icon"
            class="bi bi-exclamation-triangle-fill error-icon"
            style="display: none"
          ></i>
          <div id="password-error" class="text-danger"></div>
        </div>
      </div>

      <!-- Confirm Password input field -->
      <div class="mb-3">
        <label for="confirm-password-signup" class="form-label"
          ><b>Confirm Password</b></label
        >
        <div class="input-group">
          <input
            type="password"
            class="form-control"
            id="confirm-password-signup"
            name="confirmPassword"
            placeholder="Confirm your password"
            required
            autocomplete="off"
          />
          <!-- Icon to toggle confirm password visibility -->
          <span class="input-group-text" id="toggle-confirm-password-signup">
            <i class="bi bi-eye" id="toggle-confirm-password-signup-icon"></i>
          </span>
        </div>

        <!-- Container for displaying confirm password validation errors -->
        <div class="error-container">
          <i
            id="confirm-password-error-icon"
            class="bi bi-exclamation-triangle-fill error-icon"
            style="display: none"
          ></i>
          <div id="confirm-password-error" class="text-danger"></div>
        </div>
      </div>

      <!-- Account type selection -->
      <div class="mb-3">
        <label class="form-label"><b>Account Type</b></label>
        <div class="account-type">
          <!-- Radio button for Dog Owner -->
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="accountType"
              id="owner"
              value="owner"
              required
              checked
            />
            <label class="account-options" for="owner">Dog Owner</label>
          </div>

          <!-- Radio button for Dog Walker -->
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="accountType"
              id="walker"
              value="walker"
              required
            />
            <label class="account-options" for="walker">Dog Walker</label>
          </div>
        </div>
      </div>

      <!-- Separator line -->
      <hr class="mt-4 mb-4" />

      <!-- Submit button -->
      <button type="submit" class="btn-design-1">Sign Up</button>
    </form>
  </div>
</div>

<script>
  // Add event listener for form submission
  document
    .getElementById("signup-form")
    .addEventListener("submit", function (event) {
      let valid = true; // Flag to track form validity

      // Clear previous errors
      document.getElementById("username-error").textContent = "";
      document.getElementById("email-error").textContent = "";
      document.getElementById("password-error").textContent = "";
      document.getElementById("confirm-password-error").textContent = "";

      // Hide error icons
      document.getElementById("username-error-icon").style.display = "none";
      document.getElementById("email-error-icon").style.display = "none";
      document.getElementById("password-error-icon").style.display = "none";
      document.getElementById("confirm-password-error-icon").style.display =
        "none";

      // Validate Username
      const username = document.getElementById("username").value;
      if (username.length < 5) {
        document.getElementById("username-error").textContent =
          "Username must be at least 5 characters!";
        document.getElementById("username-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Email
      const email = document.getElementById("email-signup").value;
      if (!email.includes("@") || !email.includes(".")) {
        document.getElementById("email-error").textContent =
          "Invalid email format!";
        document.getElementById("email-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Password
      const password = document.getElementById("password-signup").value;
      if (
        password.length < 8 ||
        !/[A-Z]/.test(password) ||
        !/[a-z]/.test(password) ||
        !/[0-9]/.test(password)
      ) {
        document.getElementById("password-error").textContent =
          "Password must be at least 8 characters long and include uppercase letters, lowercase letters, and numbers!";
        document.getElementById("password-error-icon").style.display = "inline";
        valid = false;
      }

      // Validate Confirm Password
      const confirmPassword = document.getElementById(
        "confirm-password-signup"
      ).value;
      if (password !== confirmPassword) {
        document.getElementById("confirm-password-error").textContent =
          "Passwords do not match!";
        document.getElementById("confirm-password-error-icon").style.display =
          "inline";
        valid = false;
      }

      // Prevent form submission if validation fails
      if (!valid) {
        event.preventDefault();
      }
    });

  // Toggle password visibility for signup password
  document
    .getElementById("toggle-password-signup")
    .addEventListener("click", function () {
      const passwordInput = document.getElementById("password-signup");
      const toggleIcon = document.getElementById("toggle-password-signup-icon");

      // Toggle between "password" and "text" type
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        toggleIcon.classList.remove("bi-eye");
        toggleIcon.classList.add("bi-eye-slash");
      } else {
        passwordInput.type = "password";
        toggleIcon.classList.remove("bi-eye-slash");
        toggleIcon.classList.add("bi-eye");
      }
    });

  // Toggle password visibility for confirm password
  document
    .getElementById("toggle-confirm-password-signup")
    .addEventListener("click", function () {
      const confirmPasswordInput = document.getElementById(
        "confirm-password-signup"
      );
      const toggleIcon = document.getElementById(
        "toggle-confirm-password-signup-icon"
      );

      // Toggle between "password" and "text" type
      if (confirmPasswordInput.type === "password") {
        confirmPasswordInput.type = "text";
        toggleIcon.classList.remove("bi-eye");
        toggleIcon.classList.add("bi-eye-slash");
      } else {
        confirmPasswordInput.type = "password";
        toggleIcon.classList.remove("bi-eye-slash");
        toggleIcon.classList.add("bi-eye");
      }
    });
</script>
